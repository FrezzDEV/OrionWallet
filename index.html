<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>–§–∏–æ–ª–µ—Ç–æ–≤–æ–µ –º–µ–Ω—é —Å –≤—Ö–æ–¥–æ–º</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        body {
            background: #0a0a0a;
            color: white;
        }
        /* –ë—É—Ä–≥–µ—Ä-–º–µ–Ω—é */
        .menu-toggle {
            position: fixed;
            top: 25px;
            left: 25px;
            z-index: 1000;
            cursor: pointer;
            transition: all 0.3s;
            display: none; /* –°–∫—Ä—ã–≤–∞–µ–º –ø–æ–∫–∞ –Ω–µ –∑–∞–ª–æ–≥–∏–Ω–∏–ª–∏—Å—å */
        }
        .bar {
            width: 30px;
            height: 3px;
            background: #8A2BE2;
            margin: 6px 0;
            transition: 0.4s;
        }
        .menu-toggle.active .bar:nth-child(1) {
            transform: rotate(-45deg) translate(-6px, 6px);
        }
        .menu-toggle.active .bar:nth-child(2) {
            opacity: 0;
        }
        .menu-toggle.active .bar:nth-child(3) {
            transform: rotate(45deg) translate(-6px, -6px);
        }
        /* –ë–æ–∫–æ–≤–æ–µ –º–µ–Ω—é */
        .sidebar {
            position: fixed;
            left: -300px;
            top: 0;
            width: 250px;
            height: 100%;
            background: #1a1a1a;
            padding: 80px 25px 25px;
            transition: 0.3s;
            box-shadow: 4px 0 15px rgba(138, 43, 226, 0.2);
            display: none; /* –°–∫—Ä—ã–≤–∞–µ–º –ø–æ–∫–∞ –Ω–µ –∑–∞–ª–æ–≥–∏–Ω–∏–ª–∏—Å—å */
        }
        .sidebar.active {
            left: 0;
        }
        /* –ü—É–Ω–∫—Ç—ã –º–µ–Ω—é */
        .menu-item {
            color: white;
            text-decoration: none;
            padding: 15px;
            margin: 10px 0;
            display: block;
            border-radius: 8px;
            transition: 0.3s;
            position: relative;
            overflow: hidden;
        }
        .menu-item:before {
            content: '';
            position: absolute;
            left: -100%;
            top: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                rgba(138, 43, 226, 0) 0%,
                rgba(138, 43, 226, 0.2) 50%,
                rgba(138, 43, 226, 0) 100%
            );
            transition: 0.5s;
        }
        .menu-item:hover {
            background: #2d2d2d;
            transform: translateX(10px);
        }
        .menu-item:hover:before {
            left: 100%;
        }

        /* –í—Ö–æ–¥–Ω–∞—è —Ñ–æ—Ä–º–∞ */
        #login-container {
            max-width: 300px;
            margin: 100px auto;
            color: white;
            text-align: center;
        }
        #login-container input {
            width: 100%;
            padding: 8px;
            margin-top: 6px;
            margin-bottom: 15px;
            border: none;
            border-radius: 4px;
            font-size: 16px;
        }
        #login-container button {
            background-color: #8A2BE2;
            border: none;
            color: white;
            padding: 10px;
            width: 100%;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        #login-container button:hover {
            background-color: #7a21d1;
        }
        #message {
            margin-top: 15px;
            height: 20px;
        }
        /* –ü–æ—Å–ª–µ –≤—Ö–æ–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –º–µ–Ω—é */
        #content {
            display: none;
        }
    </style>
</head>
<body>
    <!-- –í—Ö–æ–¥ -->
    <div id="login-container">
        <h2>–í—Ö–æ–¥ / –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
        <form id="login-form">
            <label for="tg_id">Telegram ID:</label><br />
            <input type="number" id="tg_id" name="tg_id" required /><br />

            <label for="tg_username">Telegram username (@username):</label><br />
            <input type="text" id="tg_username" name="tg_username" required pattern="^@.+" /><br />

            <button type="submit">–í–æ–π—Ç–∏</button>
        </form>
        <p id="message"></p>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç (—Å–∫—Ä—ã—Ç –¥–æ –≤—Ö–æ–¥–∞) -->
    <div id="content">
        <!-- –ë—É—Ä–≥–µ—Ä-–º–µ–Ω—é -->
        <div class="menu-toggle">
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="bar"></div>
        </div>

        <!-- –ë–æ–∫–æ–≤–æ–µ –º–µ–Ω—é -->
        <nav class="sidebar">
            <a href="#" class="menu-item" id="profile-link">üë§ –í–∞—à –ø—Ä–æ—Ñ–∏–ª—å</a>
            <a href="#" class="menu-item" id="balance-link">üí∞ –ë–∞–ª–∞–Ω—Å: <span id="balance-value">0</span> –±–∞–ª–ª–æ–≤</a>
            <a href="#" class="menu-item" id="withdrawals-link">üì§ –ó–∞—è–≤–∫–∏: <span id="withdrawals-count">0</span>, –ë–∞–ª–ª—ã: <span id="withdrawals-points">0</span>, –°—É–º–º–∞: $<span id="withdrawals-sum">0.00</span></a>
            <a href="#" class="menu-item">üí≥ –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ</a>
            <a href="#" class="menu-item">üõç –ú–∞–≥–∞–∑–∏–Ω</a>
        </nav>
    </div>

    <script>
        const form = document.getElementById('login-form');
        const message = document.getElementById('message');
        const loginContainer = document.getElementById('login-container');
        const content = document.getElementById('content');
        const menuToggle = document.querySelector('.menu-toggle');
        const sidebar = document.querySelector('.sidebar');
        const balanceValue = document.getElementById('balance-value');
        const withdrawalsCount = document.getElementById('withdrawals-count');
        const withdrawalsPoints = document.getElementById('withdrawals-points');
        const withdrawalsSum = document.getElementById('withdrawals-sum');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            message.textContent = '';
            const tg_id = document.getElementById('tg_id').value.trim();
            const tg_username = document.getElementById('tg_username').value.trim();

            try {
                const response = await fetch('/api/check_user', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ tg_id, tg_username })
                });
                const data = await response.json();

                if (data.exists) {
                    message.style.color = 'lightgreen';
                    message.textContent = '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–π–¥–µ–Ω! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å.';

                    // –°–∫—Ä—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É –≤—Ö–æ–¥–∞ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –º–µ–Ω—é
                    loginContainer.style.display = 'none';
                    content.style.display = 'block';
                    menuToggle.style.display = 'block';
                    sidebar.style.display = 'block';

                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Å–µ—Ä–≤–µ—Ä–∞
                    loadUserData(tg_id);

                } else {
                    message.style.color = 'red';
                    message.textContent = '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –≤ –±–æ—Ç–µ.';
                }
            } catch (error) {
                message.style.color = 'red';
                message.textContent = '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.';
                console.error(error);
            }
        });

        async function loadUserData(tg_id) {
            try {
                const res = await fetch('/api/get_user_data', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ tg_id })
                });
                const data = await res.json();

                if (data.success) {
                    balanceValue.textContent = data.balance;
                    withdrawalsCount.textContent = data.withdrawals_count;
                    withdrawalsPoints.textContent = data.withdrawals_points;
                    withdrawalsSum.textContent = (data.withdrawals_points / 100).toFixed(2);
                } else {
                    balanceValue.textContent = '0';
                    withdrawalsCount.textContent = '0';
                    withdrawalsPoints.textContent = '0';
                    withdrawalsSum.textContent = '0.00';
                }
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö:', e);
            }
        }

        // –ë—É—Ä–≥–µ—Ä-–º–µ–Ω—é –æ—Ç–∫—Ä—ã—Ç–∏–µ/–∑–∞–∫—Ä—ã—Ç–∏–µ
        menuToggle.addEventListener('click', () => {
            menuToggle.classList.toggle('active');
            sidebar.classList.toggle('active');
        });
    </script>
</body>
</html>
